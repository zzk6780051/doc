# 小说章节分割工具

一个智能的自动化工具，能够将完整的小说文本文件按章节自动分割成独立文件，支持多种章节格式识别。

## 主要功能

### 🎯 智能章节识别
- **多格式支持**：自动识别中英文章节格式
  - 中文：`第X章`、`第X回`、`## 第X章`等
  - 英文：`Chapter X`、`CHAPTER X`等
  - 其他：`【第X章】`、`[第X章]`等
- **自适应检测**：自动分析文本模式，选择最匹配的章节识别规则
- **上下文验证**：智能判断章节标题的有效性，避免误识别

### 📁 自动化处理
- **批量处理**：支持一次处理多个小说文件
- **文件组织**：
  - 自动创建以原文件名为名的输出目录
  - 自动生成ZIP压缩包（保存在`zip/`目录）
- **状态管理**：
  - 成功处理的文件移动到 `already/` 目录
  - 处理失败的文件移动到 `failed/` 目录
  - 生成处理统计和元数据文件

### 🔧 技术特性
- **多编码支持**：自动检测文件编码（UTF-8、GBK、GB18030等）
- **内容去重**：基于MD5哈希值识别并跳过重复章节
- **元数据提取**：自动提取小说标题、作者等信息
- **文件名清理**：自动清理无效字符，生成安全的文件名
- **ZIP压缩**：自动为每本小说生成压缩包

## 使用方式

### 1. GitHub Actions 自动化

#### 触发条件
- `push` 到包含 `.txt` 文件的提交
- 手动触发 (`workflow_dispatch`)

#### 工作流程步骤
1. **环境设置** - 检出代码、设置Python环境
2. **目录准备** - 创建必要的输出目录（already/, zip/）
3. **文件处理** - 查找并处理所有根目录下的txt文件
4. **章节分割** - 使用fenli.py分割章节并生成ZIP文件
5. **结果整理** - 移动已处理文件到already/目录
6. **提交更改** - 自动提交分割后的章节文件和ZIP压缩包

#### 环境变量配置
需要在GitHub仓库Secrets中配置：
- `GIT_EMAIL` - Git提交邮箱
- `GIT_NAME` - Git提交用户名

## 输出结构

处理完成后，每个小说文件会生成对应的输出：

```
zip/
├── 小说文件名.zip          # 包含所有章节的压缩包

小说文件名/                 # 章节文件目录
├── 章节标题1.txt
├── 章节标题2.txt
├── ...
├── metadata.txt          # 元数据信息
└── split_stats.txt       # 处理统计

already/                  # 已处理的原始文件
└── 小说文件名.txt
```

### 2. 手动运行

#### 处理单个文件
```bash
python fenli.py 小说.txt -o 输出目录
```

#### 批量处理所有txt文件
```bash
python fenli.py -a
```

#### 使用日志文件
```bash
python fenli.py -a --log 处理日志.log
```

## 支持的章节格式示例

- `第1章 初入江湖`
- `## 第2章 奇遇`
- `Chapter 3 The Beginning`
- `【第4章】秘境探险`
- `第一百二十五章 大结局`
- `卷三 第5回 风云再起`

## 优势特点

1. **高精度识别**：多种正则表达式模式，覆盖常见章节格式
2. **容错处理**：自动处理编码问题、重复内容、异常情况
3. **完整日志**：详细的处理日志，便于调试和监控
4. **无侵入式**：原文件保持完整，处理失败可重新尝试
5. **跨平台**：支持Windows、Linux、macOS系统
6. **ZIP打包**：自动生成压缩包，便于分发和下载

#